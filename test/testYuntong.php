<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Weiming\Libs\Utils;

$parterNo = '{"org":"13020052","mchId":"1302180400011"}';
$parterKey = '{"aesKey":"e6442hXl525nls7V","pubKey":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAili3cRaKQFbIcyeYnBy4h4Dr0O2ATxIjscct3xC4xsgJmAt0fkjQCxBAKhGQjgJvaKhPxOh5h1kLFsSf2WweB73hHdg68BYHNI4jUNy4g4DhS2+QKtWlZvtogtneZstrIIf3XHrwh3Akz00DkXC5qf3QTNZ/wFtUu05tUDaR4/EUuLv90/nZwDwp22Sd/kuyQsewFab5LnrucfvG/lf8tnHsm3ZM2x/pXmu49zSzfGtgDqdpBJdozznGkZMEtdDBURSXoiXk6imMiwqD96jZ3gzJePPXIjI/E6FYSlfrQoUDICvs8RSTGYVJC6V1IgX7W946181ZI7ksjTpW2lGEQwIDAQAB","priKey":"MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC3X9x8May6gkZOyHMkn82zSwi77loYXkNh/zt19Ai8QbGENh2MlM9eOqZ1ASLfZxpLnimUR5YLjOnptiwrNskZOgFqq8SCHoNukyIvsi0x7Zkmlvbp+S0PfnBPybFWc8S9eBCAXczh1eBNma7bS4goEvDkzej8OOvXdbiYHbbSIhppBLuY8fBgFGH9VY4zCS6igP0VdsUIjfihUWkyFfIL7dNvvB5OinQNgwcHpQ5OiimB+DLdQT4iS8Hi0tFZQeUg5aoc3TidSjcuAGII0TjJMWozhrZrLwEAAOrdneU7OpeK6FUAnTHgtg9poDaA4mydVe1DksLEPiLD5sstyvAZAgMBAAECggEALYSyKnH6OmHUKgI/8rtoSDU7+cp0us/LUiwVCnaFJJX6BqOYOilGQFG2uByMF4B0WojsMU6DxGI6PjVmSWPUD1sCtwPkR5hjb7M+LTDBXz9nYNjgebvMn6f3IRcj2h3qnE2Naw/dp8F7aEfZy724EpqBCYrDZriKcnVaWQgnNYmuCBmBSQwwNoX3iHkvnx7axoFUGCPtOk7YuU7jcp8xLGEWQNKwcYgRs35luJDYFmrvWxBj0Un1KxLOA1nC82GLymYZfxOgM9yk4tiBGNeVQfzuXVxbFm/ExI+3e84o9tnAvut98+8BGMDloBqWWUcvQoj7O1NkCCCyOCxPrGyYcQKBgQDcPw5yaa5QHc1Fh+bZA3UqmYjYtuh561c4DxJ8BzP7L1+wFr8eE34FNrZiake98GITn1xgpPDeQCF2M9bvEz74tvxEne74pfPjdYB/RCFgBbghFgzHSEepsoJ829jAWXNntQ3ugIrbF7VM0yOsNPlkSdiukxOaAhHo+fJ7RT1dfwKBgQDVJH46CZl2zEiGzGl7VX7WEDTX/j+nGwJ1qdtFhPq0hghGMH/YUdOrBaEg4sDSHESSbFZ4/+L/z+lRkQZ8SJWZk/4bdAX94ZuONIsna7vmNY9PoBvSxFB5CVDrVtjFYKI+fbm3xayqYX0qju3+HmBeeL/QRyW5OfJnmYJiBnKuZwKBgHEvtqz1wq9JoYRqIyjDriMGZF17Il4Fo/0bQdSbnwsnfXVxOyapvcnQJErPc68ZKk4LR94i5eZR7uBgI8UZjvMiluJsh7MhFgV/DVpaGQzP46CdRFPlwW5kXsrr8KhpT/WsBkzbooCV3oZsu5h0YPY5PTH6Q8iR58JjMUpIexDhAoGBAIp9jsL5L80ACXQE59jqgWJn314k5okWxK9dcYsnT5ryp/erVbZh3K34F2z9yRn8ohWd7UXrxjw/hLOqDtO8ee/zOB3wcmA3MlLhEzXHC60WSgsL1mhJhJxQkFKJ+ImvM1x1ZrHg8EM42xJHEp6WcDmSLdgQEpPa8gWcuholZGirAoGBALjoFmVD3NvtwKou0+6rVmchx+MmKWe9NMTAW3A3QkxGb53ljUkagRC9zBzQ/3peM3vSr8MI7th1Xp3hBVk+PBPW3V3WaWILjqSnQNgIOnZHlKeO5PSryPgpLaGqQQ6sJ4AavnLhtMSj7c63Flk5admReU+yv2hKOuCOBeJHg/cI"}';

// $orderNo = date('YmdHis') . mt_rand(100, 999);

// var_dump(Weiming\Libs\Payments\Yuntong::getInstance(['parterNo' => $parterNo, 'parterKey' => $parterKey, 'callbackUrl' => 'http://47.90.98.83:9898', 'notifyUrl' => ''])->signature('Z2ALIPAY', 1, $orderNo)->payment());

// callback

$callbackJson = '{"encryptData":"AB77AA822FE1AD6816FBC4CA6A7A4EEB8B7A41D73E0463A4F5FB0998B0CA4F17120A428F06B77563E04E61E211CDC2A486725DE1BBC7E7A24D3427C2AF2053B1E19D25779437D02448647CB29CEC19803321AA2159AB496AB14627FB8C8092EF7E4FB336E1A18D1FB7C3E164D9BDB99631D757178028250C445FC8434C1AD4CA4FF106E37138E06FCDE435C094ED1A1267135E368AFD6C584E9C88D67D44AC57754E2C318AB3ECCB962864229A8599B90D30CC3D56FBE9D77A2F6DA9AED1D351DB7872ABBA83ECBA422079C69769577E51F3E0CD2D6BA8459A503E931B70EFA815EF39C0DFB7A89ED8C2F5F2EFB95CA06001119BC7590D9A210626B8537CA12CEA328279EFEFD13D5878394F03D603002836B0B5AFA321F4A53C9483EF69457BDB8DC0D72B5A36954E84B14E3BE88C0CA83D3A35FAC96863B3E7A5A339C9A75A0637396E8BE8E0B5C1FFEBFFF2FD92884A087711220D055CF89386870F950ADB1ED69F71F6E4EEE9FF1F5CCEBBF30E4A15A9203D9E0F3C9B93670C6677E022471DE879FBAEB3354CEF6374E1169F1310B1C07622932A81B24613B99011F2CE712F04965B8E6DCF54E463E91D4B77F171","sign":"QaMe8gF1Zd1Y+wOHqZjFST9pHwqwNyxvTPxjEBDitC0qZv6ZH3jQE9qktQ+7MbtCow8x0B3xJYdUgXY1PUyNs4QcYygUhbprEkyGzG34W9xZpmh/6iGqGLqFKLYIbjjuEWKUl3c1DsxTv8NgLFjUbaNxo0Q1JjhFeKm06LKzLzdaqKJxgxvTYJ05CXRGfAhmLuTjFd0vVI4CfFnz1Ondamy6NfdIXurOlz09wC3uDtT/ZzbYZ0A2N5+6HnbXVnHhth8mJYfo1d0o6XEULqTAaHs8iqn8KQ2nngBiC9GB0ffBsSPTdXn7nJNXrN/Hlzyb5Ws060vaFt4NKiCWLfhckA=="}';

$datas = json_decode($callbackJson, true);

var_dump(Weiming\Libs\Payments\Yuntong::getInstance(['parterNo' => $parterNo, 'parterKey' => $parterKey, 'callbackUrl' => 'http://47.90.98.83:9898', 'notifyUrl' => ''])->callbackVerifySign(json_decode($callbackJson, true)));


echo Utils::decryptAES($datas['encryptData'], 'e6442hXl525nls7V');