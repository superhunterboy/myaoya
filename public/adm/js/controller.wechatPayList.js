app.controller("wechatPayList",["$scope","$rootScope","Table","http","ngDialog","Tip",function(t,e,a,n,i,s){t.table=a,t.setting={isEdit:!1,placeholder:"二维码编号，会员账户",currentTable:"personal",query:{}},t.temp,t.dict={0:"加微信好友支付",1:"个人微信扫码",2:"商家微信扫码",3:"智能微信扫码"},t.ptable=angular.copy(t.table),t.mtable=angular.copy(t.table),t.gtable=angular.copy(t.table),t.displayTable=function(e){switch(t.setting.currentTable=e,e){case"personal":t.setting.query=t.ptable.query,t.setting.placeholder="二维码编号，会员账户";break;case"merchant":t.setting.query=t.mtable.query,t.setting.placeholder="会员账户，单号，商户编码，商户名称";break;case"group":t.setting.query=t.gtable.query,t.setting.placeholder="支付微信号，会员账号，收款微信号"}},t.search=function(){switch(t.setting.currentTable){case"personal":t.ptable.query=$.extend(t.ptable.query,t.setting.query),t.ptable.getList(1);break;case"merchant":t.mtable.query=$.extend(t.mtable.query,t.setting.query),t.mtable.getList(1);break;case"group":t.gtable.query=$.extend(t.gtable.query,t.setting.query),t.gtable.getList(1)}},t.act=function(e,a,r){var l,c;"personal"==r?(l="/admin/updatePaySingleState/"+e.id,c=a):"merchant"==r?(l="/admin/updateOrder/"+e.id,c=a):"group"==r&&(l="/admin/updatePayQrcodeStatus/"+e.id,c=a/2),i.open({template:'<div class="confirm-dialog">                       <h2>您确定要将此记录标记为'+["已入款","已忽略"][c-1]+'吗？</h2>                      <div align="center">                          <button type="button" class="btn btn-red" ng-click="closeThisDialog(\'CONFIRM\')">确定</button>                          <button type="button" class="btn btn-default" ng-click="closeThisDialog()">取消</button>                      </div></div>',plain:!0}).closePromise.then(function(i){i.value&&"CONFIRM"==i.value&&n.post(l,{id:e.id,status:a},function(e){0==e.status?(s.success("操作成功!"),t.search(r)):s.error(e.msg)})})},t.beginEdit=function(){t.setting.isEdit=!0,t.temp=t.setting.wechat_single_qrcode},t.cancelEdit=function(){t.setting.isEdit=!1,t.setting.wechat_single_qrcode=t.temp},t.updateWechatSetting=function(){n.post("/admin/updateSetting/6",{id:6,val:t.setting.wechat_single_qrcode},function(e){0==e.status?(s.success("修改成功!"),t.setting.isEdit=!1):s.error("网络错误")})},t.getData=function(){n.get("/admin/getWechat",{},function(e){0==e.status&&e.data[0]?t.setting.wechat_single_qrcode=e.data[0].val+"":s.error("网络错误")})},t.getData(),t.ptable.init({link:"/admin/paySingles"}).getList(),t.mtable.init({link:"/admin/PayMerchants",query:{type:1}}).getList(),t.gtable.init({link:"/admin/getPayQrcodes"}).getList(),t.editRemark=function(e){i.open({template:"template/wechatDialog.html",controller:"wechatRemarkEdit",data:e}).closePromise.then(function(e){e&&0==e.value.status&&(t.gtable.getList(),s.success("修改成功!"))})}}]),app.controller("wechatRemarkEdit",["$scope","http","$rootScope",function(t,e,a){t.list=angular.copy(t.ngDialogData),t.check=function(){return!(t.list.result.length>50)||(t.error=!0,t.errorMsg="备注过长，请缩减至50字以内",!1)},t.sub=function(){t.check()&&e.post("/admin/updatePayQrcodeRemark/"+t.list.id,{remark:t.list.result},function(e){0==e.status?t.closeThisDialog(e):(t.error=!0,t.errorMsg="网络错误")})}}]);