app.directive("datatype",function(){return{require:"?ngModel",priority:1e3,link:function(e,a,t,r){t.datatype=t.datatype||"INT";var n=t.datatype.replace(/\d/,"X").toUpperCase();if("INT"==n||"DOUBLEX"==n){var l=[8,13],u=[96,97,98,99,100,101,102,103,104,105,37,38,39,40,46,9],i=[48,49,50,51,52,53,54,55,56,57],o=[65],p=[110,190];if(a.on("keydown",function(e){return!!l.some(function(a){return a==e.keyCode})||(!!u.some(function(a){return a==e.keyCode})||(!!i.some(function(a){return a==e.keyCode&&!e.shiftKey})||(!!o.some(function(a){return a==e.keyCode&&e.ctrlKey})||(!("DOUBLEX"!=n||-1!=e.target.value.indexOf(".")||!p.some(function(a){return a==e.keyCode}))||(e.preventDefault(),e.target.value=e.target.value.replace(/[^\d.]/g,""),!1)))))}),r.$parsers.unshift(function(e){return e?(e=e.replace(/[^\d.]/g,""),r.$viewValue=a[0].value=e,e):e}),"DOUBLEX"==n){var s=parseInt(t.datatype.slice(6))||1;a.on("blur ",function(n){if(isNaN(parseFloat(a[0].value)))r.$setViewValue(""),a[0].value="",e.$apply();else{var l=parseFloat(a[0].value);l=l.toFixed(s),r.$setViewValue(l),e.$eval(t.ngModel+"='"+l+"'"),a[0].value=l,e.$apply()}})}else a.on("blur",function(n){if(isNaN(parseInt(a[0].value)))r.$setViewValue(""),a[0].value="",e.$apply();else{var l=parseInt(a[0].value).toString();r.$setViewValue(l),e.$eval(t.ngModel+"='"+l+"'"),a[0].value=l,e.$apply()}})}else"EN"==n&&(r.$parsers.unshift(function(e){return e?(e=e.replace(/[^a-zA-Z\d]/g,""),r.$viewValue=a[0].value=e,e):e}),a.on("blur keyup afterpaste",function(){var n=a[0].value.replace(/[^a-zA-Z\d]/g,"");r.$setViewValue(n),e.$eval(t.ngModel+"='"+n+"'"),a[0].value=n,e.$apply()}))}}});