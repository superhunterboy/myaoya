app.controller("bankEdit",["$scope","http",function(t,e){t.list={count:0,level_ids:"",type:2},t.url="/admin/addBankCard",t.levels=[],t.ngDialogData&&(t.list=angular.copy(t.ngDialogData),t.url="/admin/updateBankCard/"+t.list.id,t.levels=t.list.level_ids.split(",")),e.get("/admin/levels",{},function(e){0==e.status&&(t.levelList=e.data,t.levels.length>0&&t.levelList.forEach(function(e){t.levels.indexOf(""+e.id)>-1&&(e.checked=!0)}))}),t.check=function(){if(!t.list.bank_name)return t.error=!0,t.errorMsg="请填写银行名称！",!1;if(!t.list.bank_number)return t.error=!0,t.errorMsg="请填写银行卡号！",!1;if(!t.list.user_name)return t.error=!0,t.errorMsg="请填写银行户名！",!1;var e=[];return t.levelList.forEach(function(t){t.checked&&e.push(t.id)}),t.list.level_ids=e.join(","),!0},t.sub=function(){!t.loading&&t.check()&&(t.loading=!0,e.post(t.url,t.list,function(e){t.loading=!1,0==e.status?t.closeThisDialog(e):(t.error=!0,t.errorMsg=e.msg)}))}}]),app.controller("bankSetting",["$scope","$rootScope","http","Table","ngDialog","Tip",function(t,e,n,l,i,a){t.table=l.init({link:"/admin/bankCards?type=2"}),t.table.getList(),n.get("/admin/levels",{},function(e){0==e.status&&(t.levelList=e.data,t.levelObj={},t.levelList.forEach(function(e){t.levelObj[""+e.id]=e.name}))}),t.edit=function(e){i.open({template:"template/bankEditDialog.html",controller:"bankEdit",data:e}).closePromise.then(function(e){e.value&&0==e.value.status&&t.table.getList()})},t.del=function(e){i.open({template:'<div class="confirm-dialog">             <h2>您确定要删除银行卡“'+e.bank_number+'”吗？</h2>            <div align="center">                <button type="button" class="btn btn-red" ng-click="closeThisDialog(\'CONFIRM\')">确定</button>                <button type="button" class="btn btn-default" ng-click="closeThisDialog()">取消</button>            </div></div>',plain:!0}).closePromise.then(function(l){l.value&&"CONFIRM"==l.value&&n.get("/admin/deleteBankCard/"+e.id,{},function(e){0==e.status&&(t.table.getList(1),a.success("删除成功"))})})},t.act=function(e,l){n.post("/admin/updateBankCard/"+e.id,{status:l},function(e){0==e.status?(t.table.getList(),a.success("操作成功")):a.error(e.msg)})}}]);