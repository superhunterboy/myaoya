app.controller("alipayBankChange",["$scope","http","ngDialog","Tip",function(a,n,t,e){a.list=angular.copy(a.ngDialogData),a.list.actId=""+a.list.actBank.id,a.sub=function(){var t=a.list.banks.filter(function(n){return n.id==a.list.actId})[0];t.status=1,n.post("/admin/updateBankCard/"+a.list.actId,t,function(n){0==n.status?a.closeThisDialog(n):e.error(n.msg)})}}]),app.controller("alipayBankEdit",["$scope","http","ngDialog","Tip",function(a,n,t,e){a.temp=a.ngDialogData,a.bank=angular.copy(a.ngDialogData),a.bank.name?a.bankName=a.bank.name:a.bank={banks:[],actBank:{},name:""},a.add=function(){a.bank.banks.push({bank_name:a.bank.name,user_name:"",bank_number:"",address:""})},a.del=function(s,i){s.id?t.open({template:'<div class="confirm-dialog">                     <h2>您确定要删除银行卡“'+s.bank_number+'”吗？</h2>                    <p>删除后将无法恢复！</p>                    <div align="center">                        <button type="button" class="btn btn-red" ng-click="closeThisDialog(\'CONFIRM\')">确定</button>                        <button type="button" class="btn btn-default" ng-click="closeThisDialog()">取消</button>                    </div></div>',plain:!0}).closePromise.then(function(t){t.value&&"CONFIRM"==t.value&&n.get("/admin/deleteBankCard/"+s.id,{},function(n){0==n.status?(e.success("删除成功！"),a.bank.banks=a.bank.banks.filter(function(a){return a.id!=s.id})):e.error(n.msg)})}):a.bank.banks.splice(i,1)},a.check=function(){a.banks=[];var n=0;if(!a.bank.name)return a.error=!0,a.errorMsg="请填写银行名称",!1;if(0==a.bank.banks.length)return a.error=!0,a.errorMsg="请添加银行卡",!1;for(var t=0;t<a.bank.banks.length;t++){var e={bank_name:a.bank.name,user_name:a.bank.banks[t].user_name,bank_number:a.bank.banks[t].bank_number,address:a.bank.banks[t].address};if(!a.bank.banks[t].user_name||!a.bank.banks[t].bank_number)return a.error=!0,a.errorMsg="请填写第"+(t+1)+"张银行卡的完整信息",!1;!a.bank.banks[t].id||e.user_name==a.temp.banks[t].user_name&&e.bank_number==a.temp.banks[t].bank_number&&e.address==a.temp.banks[t].address?a.bank.banks[t].id||a.banks.push(e):(e.id=a.bank.banks[t].id,a.banks.push(e)),n++}return n==a.bank.banks.length},a.sub=function(){a.check()&&n.post("/admin/updateBankCards",{banks:angular.toJson(a.banks,!0)},function(n){0==n.status?(e.success("操作成功！"),a.closeThisDialog(n)):e.error(n.msg)})}}]),app.controller("alipayBankList",["$scope","$rootScope","Table","http","ngDialog","Tip",function(a,n,t,e,s,i){a.getList=function(){a.bankList={},e.get("/admin/bankCards",{},function(n){a.banks=n,a.banks.forEach(function(n){a.bankList[n.bank_name]||(a.bankList[n.bank_name]={banks:[],actBank:{},name:n.bank_name}),a.bankList[n.bank_name].banks.push(n),1==n.status&&(a.bankList[n.bank_name].actBank=n)})})},a.getList(),a.editBank=function(n){n=n||{},s.open({template:"template/alipayBankEditDialog.html",controller:"alipayBankEdit",data:n,closeByDocument:!1,className:"ngdialog-theme-default large"}).closePromise.then(function(n){n&&0==n.value.status&&a.getList()})},a.changeBank=function(n){s.open({template:"template/alipayBankChangeDialog.html",controller:"alipayBankChange",data:n}).closePromise.then(function(n){n&&0==n.value.status&&(a.getList(),i.success("切换成功!"))})}}]);