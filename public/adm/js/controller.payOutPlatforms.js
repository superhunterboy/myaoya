app.controller("rechargeLinks",["$scope","http","Table","ngDialog","Tip","payOutType",function(t,a,e,o,n,i){t.location=window.location,t.payOutType=i,t.platform=t.ngDialogData.platform,t.t=e,t.table=angular.copy(t.t),t.table.init({link:"/admin/rechargeLinks",query:{prePage:10}}),t.table.query.platformId="",t.platform&&(t.table.query.platformId=t.platform.id),t.table.getList(),a.get("/admin/platforms",{page:1,perPage:999},function(a){a.data&&(t.platformsList=a.data)}),t.copy=function(t){$("#"+t)[0].select(),document.execCommand("copy"),n.success("复制链接成功！")},t.changeStatus=function(e){a.get("/admin/updateLinkStatus/"+e.id,{},function(a){0==a.status&&(t.table.getList(),n.success("切换成功"))})},t.delLink=function(e){o.open({template:'<div class="confirm-dialog">               <h2>您确定要删除充值外链“'+e.remark+'”吗？</h2>              <div align="center">                  <button type="button" class="btn btn-red" ng-click="closeThisDialog(\'CONFIRM\')">确定</button>                  <button type="button" class="btn btn-default" ng-click="closeThisDialog()">取消</button>              </div></div>',plain:!0}).closePromise.then(function(o){o.value&&"CONFIRM"==o.value&&a.get("/admin/deleteLink/"+e.id,{},function(a){0==a.status?(t.table.getList(),n.success("删除成功")):n.error(a.msg)})})},t.addLink=function(){o.open({template:"template/addRechargeLinksDialog.html",controller:"addRechargeLinks",data:{platformsList:t.platformsList}}).closePromise.then(function(a){a.value&&0==a.value.status&&(t.table.getList(),n.success("添加成功"))})}}]),app.controller("addRechargeLinks",["$scope","http","Table","payOutType",function(t,a,e,o){t.payOutType=o,t.platformsList=t.ngDialogData.platformsList,t.link={},t.check=function(){return t.link.platform_id?!!t.link.remark||(t.error=!0,t.errorMsg="请填写备注！",!1):(t.error=!0,t.errorMsg="请选择出款平台！",!1)},t.sub=function(){!t.loading&&t.check()&&(t.loading=!0,a.post("/admin/addLink",t.link,function(a){t.loading=!1,0==a.status?t.closeThisDialog(a):(t.error=!0,t.errorMsg=a.msg)}))}}]),app.controller("chargeList",["$scope","http","Table","payOutType",function(t,a,e,o){t.payOutType=o,t.platform=t.ngDialogData,t.t=e,t.table=angular.copy(t.t),t.table.init({link:"/admin/getRecharges",query:{platformId:t.platform.id,prePage:10}}),t.table.getList()}]),app.controller("payOutPlatformEdit",["$scope","http","payOutType",function(t,a,e){t.platform={},t.payOutType=e,t.companyInfo=t.ngDialogData.companyInfo,t.ngDialogData.platform&&(t.id=t.ngDialogData.platform.id,t.platform.id=t.ngDialogData.platform.id,t.platform.company_id=String(t.ngDialogData.platform.company_id),t.platform.pay_out_type=String(t.ngDialogData.platform.pay_out_type),t.platform.no=t.ngDialogData.platform.no,t.platform.key=t.ngDialogData.platform.key,t.platform.callback_url=t.ngDialogData.platform.callback_url,t.platform.notify_url=t.ngDialogData.platform.notify_url),t.check=function(){return t.platform.company_id?t.platform.pay_out_type?t.platform.no?t.platform.key?t.platform.callback_url?!!t.platform.notify_url||(t.error=!0,t.errorMsg="请填写通知地址！",!1):(t.error=!0,t.errorMsg="请填写回调地址！",!1):(t.error=!0,t.errorMsg="请填写商户key！",!1):(t.error=!0,t.errorMsg="请填写商户编号！",!1):(t.error=!0,t.errorMsg="请选择支付平台！",!1):(t.error=!0,t.errorMsg="请选择所属业务平台！",!1)},t.save=function(){!t.loading&&t.check()&&(t.loading=!0,a.post("/admin/addPlatform",t.platform,function(a){t.loading=!1,0==a.status?t.closeThisDialog(a):(t.error=!0,t.errorMsg=a.msg)}))},t.update=function(){!t.loading&&t.check()&&(t.loading=!0,a.post("/admin/editPlatform/"+t.id,t.platform,function(a){t.loading=!1,0==a.status?t.closeThisDialog(a):(t.error=!0,t.errorMsg=a.msg)}))}}]),app.controller("changePlatform",["$scope","http","Tip",function(t,a,e){t.subDate={type:t.ngDialogData.type},t.listId=t.ngDialogData.platform.id,t.time=0,t.sendCode=function(){if(0==t.time){a.get("/admin/sendCode",{},function(t){0==t.status?e.success("发送成功"):e.error(t.msg)}),t.time=30;var o=setInterval(function(){t.time--,0==t.time&&clearInterval(o),t.$apply()},1e3)}},t.check=function(){return!!t.subDate.code||(t.error=!0,t.errorMsg="请填写手机验证码！",!1)},t.sub=function(){!t.loading&&t.check()&&(t.loading=!0,a.post("/admin/changePlatform/"+t.listId,t.subDate,function(a){t.loading=!1,0==a.status?t.closeThisDialog(a):(t.error=!0,t.errorMsg=a.msg)}))}}]),app.controller("payOutPlatforms",["$scope","$rootScope","Table","http","ngDialog","$stateParams","Tip","payOutType",function(t,a,e,o,n,i,r,l){t.saveOutLimit=function(t){t.startOutLimitTemp&&t.startOutLimitTemp&&parseFloat(t.startOutLimitTemp)<=parseFloat(t.endOutLimitTemp)?o.post("/admin/updateAmountLimit/"+t.id,{start_amount_limit:t.startOutLimitTemp,end_amount_limit:t.endOutLimitTemp},function(a){0==a.status?(t.start_amount_limit=t.startOutLimitTemp,t.end_amount_limit=t.endOutLimitTemp,t.outLimitStatus=0,r.success("保存成功")):r.error(a.msg)}):r.error("请输入正确的出款额度范围")},t.payOutType=l,t.companyInfo={},o.get("/admin/companies",{page:1,perPage:999},function(a){if(a.data)for(var e=0;e<a.data.length;e++)t.companyInfo[a.data[e].id]=a.data[e]}),t.table=e.init({link:"/admin/platforms"}),t.table.getList(),t.editPlatform=function(a){n.open({template:"template/payOutPlatformEdit.html",controller:"payOutPlatformEdit",data:{platform:a,companyInfo:t.companyInfo}}).closePromise.then(function(a){a.value&&0==a.value.status&&(t.table.getList(),r.success("保存成功"))})},t.rechargeLinks=function(t){n.open({template:"template/rechargeLinksDialog.html",controller:"rechargeLinks",data:{platform:t},className:"ngdialog-theme-default max"})},t.delPlatform=function(a){n.open({template:'<div class="confirm-dialog">                   <h2>您确定要删除出款平台配置“'+t.companyInfo[a.company_id].name+"-"+t.payOutType[a.pay_out_type]+'”吗？</h2>                  <div align="center">                      <button type="button" class="btn btn-red" ng-click="closeThisDialog(\'CONFIRM\')">确定</button>                      <button type="button" class="btn btn-default" ng-click="closeThisDialog()">取消</button>                  </div></div>',plain:!0}).closePromise.then(function(e){e.value&&"CONFIRM"==e.value&&o.get("/admin/deletePlatform/"+a.id,{},function(a){0==a.status&&(t.table.getList(),r.success("删除成功"))})})},t.changePlatform=function(a,e){n.open({template:"template/changePlatformDialog.html",controller:"changePlatform",data:{platform:a,type:e}}).closePromise.then(function(a){a.value&&0==a.value.status&&(t.table.getList(),r.success("切换成功"))})},t.charge=function(t){window.open("/admin/platformRecharge?type="+t.pay_out_type+"&companyId="+t.company_id+"&platformId="+t.id,"","height=800, width=800, top=80, left=600, toolbar=no, menubar=no,location=no, status=no")},t.chargeList=function(t){n.open({template:"template/chargeListDialog.html",controller:"chargeList",data:t,className:"ngdialog-theme-default max"})},t.refresh=function(t){o.get("/admin/queryBalance/"+t.id,{},function(a){0==a.status?(r.success("更新成功"),t.balance=a.data.balance):r.error(a.msg)})}}]);